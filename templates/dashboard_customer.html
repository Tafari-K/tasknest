{% extends 'base.html' %}
{% load static %}

{% block content %}

<!-- PROFILE SECTION -->
<div class="tradesman-dashboard">
  <img src="{% static 'core/images/default_avatar.png' %}" 
       alt="Avatar" class="rounded-circle mb-2" width="120" height="120">

  <h2>{{ profile.user.username }}</h2>
  <p class="text-muted">{{ profile.role|title }}</p>

  <a href="{% url 'edit_profile' %}" class="btn btn-outline-secondary">Edit Profile</a>

  <p><strong>Location:</strong> {{ profile.location }}</p>
  <p><strong>Skills:</strong> {{ profile.skills }}</p>
  <p><strong>Jobs Completed:</strong> {{ profile.jobs_completed }}</p>
</div>

<!-- JOB STATS SECTION -->
<div class="job-stats">
  <div>
    <h4>Active Jobs</h4>
    <p class="fw-bold fs-4 text-warning">{{ active_jobs.count }}</p>
  </div>
  <div>
    <h4>Completed Jobs</h4>
    <p class="fw-bold fs-4 text-success">{{ completed_jobs.count }}</p>
  </div>
  <div>
    <h4>Pending Reviews</h4>
    <p class="fw-bold fs-4 text-muted">{{ received_reviews.count }}</p>
  </div>
</div>

<!-- ACTIVE JOBS -->
<div class="job-management">
  <h4>Jobs In Progress</h4>

  {% if active_jobs %}
    <ul>
      {% for job in active_jobs %}
        <li>
          <div>
            <strong>{{ job.title }}</strong> – {{ job.description }}
          </div>
          <div>
            <a href="{% url 'complete_job' job.id %}">Mark Complete</a>
            <a href="{% url 'remove_job' job.id %}">Remove</a>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">No active jobs right now.</p>
  {% endif %}
</div>

<!-- COMPLETED JOBS -->
<div class="completed-jobs">
  <h4>Completed Jobs</h4>

  {% if completed_jobs %}
    <ul>
      {% for job in completed_jobs %}
        <li>
          <strong>{{ job.title }}</strong> – {{ job.description }}
          <span class="badge bg-success">Completed</span>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">No completed jobs yet.</p>
  {% endif %}
</div>

<!-- CUSTOMER REVIEWS -->
<div class="customer-reviews">
  <h4>Customer Reviews</h4>

  {% if received_reviews %}
    {% for review in received_reviews %}
      <p><strong>{{ review.reviewer.user.username }}</strong> – ⭐ {{ review.rating }}/5</p>
      <p>{{ review.comment }}</p>
    {% endfor %}
  {% else %}
    <p class="text-muted">No reviews yet.</p>
  {% endif %}
</div>

<!-- ADD JOB BUTTON -->
<div>
  <a href="{% url 'add_job' %}" class="btn btn-primary">Add New Job</a>
</div>

{% endblock %}
