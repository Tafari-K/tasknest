{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="dashboard-layout">

    <aside class="profile-card">
        <img src="{% static 'images/tasknest-logo.png' %}" class="profile-avatar">

        <h1 class="profile-name">{{ profile.user.username }}</h1>
        <p class="profile-role">Tradesman</p>

        <div class="profile-actions">
            <a href="{% url 'edit_profile' %}" class="btn btn-secondary">Edit Profile</a>
            <a href="{% url 'add_job' %}" class="btn btn-primary">Add Job</a>
        </div>

        <div class="profile-meta">
            <p><strong>Location:</strong> {{ profile.location }}</p>
            <p><strong>Skills:</strong> {{ profile.skills }}</p>
            <p><strong>Jobs Completed:</strong> {{ completed_jobs_count }}</p>
        </div>
    </aside>

    <main class="dashboard-main">

        <!-- STATS -->
        <div class="stats-row">
            <div class="stat-pill">
                <div class="stat-label">Active Jobs</div>
                <div class="stat-value">{{ active_jobs_count }}</div>
            </div>
            <div class="stat-pill">
                <div class="stat-label">Completed Jobs</div>
                <div class="stat-value">{{ completed_jobs_count }}</div>
            </div>
            <div class="stat-pill">
                <div class="stat-label">Pending Reviews</div>
                <div class="stat-value">{{ received_reviews.count }}</div>
            </div>
        </div>

        <!-- JOBS IN PROGRESS -->
        <section class="section-card">
            <h2>Jobs In Progress</h2>

            {% if active_jobs %}
                {% for job in active_jobs %}
                    <div class="job-item">
                        <span class="job-item-title">{{ job.title }}</span> – {{ job.description }}
                        <div>
                            <a href="{% url 'complete_job' job.id %}">Mark Complete</a> ·
                            <a href="{% url 'remove_job' job.id %}">Remove</a>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p>No active jobs right now.</p>
            {% endif %}
        </section>

        <!-- COMPLETED JOBS -->
        <section class="section-card">
            <h2>Completed Jobs</h2>

            {% if completed_jobs %}
                {% for job in completed_jobs %}
                    <div class="job-item">
                        <span class="job-item-title">{{ job.title }}</span> – {{ job.description }}
                        <span class="badge bg-success">Completed</span>
                    </div>
                {% endfor %}
            {% else %}
                <p>No completed jobs yet.</p>
            {% endif %}
        </section>

        <!-- REVIEWS RECEIVED -->
        <section class="section-card">
            <h2>Reviews Received</h2>

            {% if received_reviews %}
                {% for review in received_reviews %}
                    <div class="review-item">
                        <span class="review-author">{{ review.reviewer.user.username }}</span>
                        <span class="review-rating">★ {{ review.rating }}/5</span>
                        <p>{{ review.comment }}</p>
                    </div>
                {% endfor %}
            {% else %}
                <p>No reviews received yet.</p>
            {% endif %}
        </section>

        <a href="{% url 'add_job' %}" class="btn btn-primary">Add New Job</a>

    </main>

</div>

{% endblock %}
