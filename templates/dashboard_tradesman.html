{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'core/css/dashboard.css' %}">
{% endblock %}
{% block content %}

<div class="container py-4">
  <div class="row">

    <aside class="col-md-4">
      <!-- PROFILE SECTION -->
      <div class="tradesman-dashboard">
        <img src="{% static 'images/tasknest-logo.png' %}" 
            alt="Avatar" class="rounded-circle mb-2" width="120" height="120">
        <h2>{{ profile.user.username }}</h2>
        <p class="text-muted">{{ profile.role|title }}</p>

        <a href="{% url 'edit_profile' %}" class="btn btn-outline-secondary">Edit Profile</a>
        <a href="{% url 'add_job' %}">Add Job</a>


        <p><strong>Location:</strong> {{ profile.location }}</p>
        <p><strong>Skills:</strong> {{ profile.skills }}</p>
        <p><strong>Jobs Completed:</strong> {{ profile.jobs_completed }}</p>
      </div>
    </aside>

    <main class="col-md-8">

      <!-- JOB STATS SECTION -->
      <div class="job-stats">
  <div>
    <h4>Active Jobs</h4>
    <p class="fw-bold fs-4 text-warning">{{ active_jobs_count }}</p>
  </div>
  <div>
    <h4>Completed Jobs</h4>
    <p class="fw-bold fs-4 text-success">{{ completed_jobs_count }}</p>
  </div>
  <div>
    <h4>Pending Reviews</h4>
    <p class="fw-bold fs-4 text-muted">0</p>
  </div>
</div>

<!-- JOB MANAGEMENT -->
<div class="job-management">
  <div>
    <h4>Jobs</h4>
  </div>
  <div>
  {% if active_jobs %}
    <ul>
      {% for job in active_jobs %}
        <li>
          <div>
            <strong>{{ job.title }}</strong> - {{ job.description }}
          </div>
          <div>
            <a href="{% url 'complete_job' job.id %}">Mark Complete</a>
            <a href="{% url 'remove_job' job.id %}">Remove</a>
          </div>
        </li>
      {% endfor %}
    </ul>
    {% else %}
      <p class="text-muted">No active jobs right now.</p>
    {% endif %}
  </div>
</div>

<!-- COMPLETED JOBS -->
<div class="completed-jobs">
  <div>
    <h4>Completed Jobs</h4>
  </div>
  <div>
    {% if completed_jobs %}
    <ul>
      {% for job in completed_jobs %}
      <li>
        <strong>{{ job.title }}</strong> - {{ job.description }}
        <span class="badge bg-success">Completed</span>
      </li>
      {% endfor %}
    </ul>
    {% else %}
      <p class="text-muted">No completed jobs yet.</p>
    {% endif %}
  </div>
</div>

<!-- CUSTOMER REVIEWS -->
<div class="reviews-section">
  <h4>Reviews Received</h4>

  {% if received_reviews %}
      {% for review in received_reviews %}
          <p>
            <strong>{{ review.reviewer.user.username }}</strong>
            ‚≠ê {{ review.rating }}/5
          </p>
          <p>{{ review.comment }}</p>
          <hr>
      {% endfor %}
  {% else %}
      <p>No reviews received yet.</p>
  {% endif %}
</div>


      <!-- ADD JOB BUTTON -->
      <div>
        <a href="{% url 'add_job' %}" class="btn btn-primary">Add New Job</a>
      </div>

    </main>
  </div>
</div>

{% endblock %}
