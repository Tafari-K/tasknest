{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="dashboard-layout">

    <!-- LEFT SIDEBAR PROFILE -->
    <aside class="profile-card">
        <img src="{% static 'images/tasknest-logo.png' %}" alt="Avatar" class="profile-avatar">

        <h1 class="profile-name">{{ user.username }}</h1>
        <p class="profile-role">{{ profile.role|title }}</p>

        <div class="profile-actions">
            {% if profile.role == 'tradesman' %}
                <a href="{% url 'add_job' %}" class="btn btn-primary">Add Job</a>
            {% endif %}
            <a href="{% url 'edit_profile' %}" class="btn btn-secondary">Edit Profile</a>
        </div>

        <div class="profile-meta">
            <p><strong>Location:</strong> {{ profile.location }}</p>
            <p><strong>Skills:</strong> {{ profile.skills }}</p>
            <p><strong>Jobs Completed:</strong> {{ profile.jobs_completed }}</p>
        </div>
    </aside>

    <!-- RIGHT MAIN CONTENT -->
    <main class="dashboard-main">

        <!-- STATS -->
        <div class="stats-row">
            <div class="stat-pill">
                <div class="stat-label">Active Jobs</div>
                <div class="stat-value">{{ active_jobs }}</div>
            </div>
            <div class="stat-pill">
                <div class="stat-label">Completed Jobs</div>
                <div class="stat-value">{{ completed_jobs }}</div>
            </div>
        </div>

        <!-- ACTIVE JOBS -->
        <section class="section-card">
            <h2>Active Jobs</h2>

            {% if active_jobs_list %}
                <div class="thumb-grid">
                    {% for job in active_jobs_list %}
                        <div class="thumb-card">
                            <img src="{{ job.image.url if job.image else static 'images/placeholder.jpg' }}" alt="{{ job.title }}">
                            <div class="thumb-title">{{ job.title|truncatechars:28 }}</div>

                            <div class="job-actions">
                                <a href="{% url 'edit_job' job.id %}" class="btn-edit">Edit</a>
                                <form action="{% url 'delete_job' job.id %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit" class="btn-delete">Delete</button>
                                </form>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>No active jobs yet.</p>
            {% endif %}
        </section>

        <!-- COMPLETED JOBS -->
        <section class="section-card">
            <h2>Completed Jobs</h2>

            {% if completed_jobs_list %}
                <div class="thumb-grid">
                    {% for job in completed_jobs_list %}
                        <div class="thumb-card completed-card">
                            <img src="{{ job.image.url if job.image else static 'images/placeholder.jpg' }}">
                            <div class="thumb-title">{{ job.title|truncatechars:28 }}</div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>No completed jobs yet.</p>
            {% endif %}
        </section>

        <!-- DELETED JOBS -->
        <section class="section-card">
            <h2>Deleted Jobs</h2>

            {% if deleted_jobs_list %}
                <div class="thumb-grid">
                    {% for job in deleted_jobs_list %}
                        <div class="thumb-card deleted-card">
                            <img src="{{ job.image.url if job.image else static 'images/placeholder.jpg' }}">
                            <div class="thumb-title">{{ job.title|truncatechars:28 }}</div>

                            <form action="{% url 'restore_job' job.id %}" method="post">
                                {% csrf_token %}
                                <button type="submit" class="btn-restore">Restore</button>
                            </form>

                            <div class="deleted-badge">Deleted</div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>No deleted jobs.</p>
            {% endif %}
        </section>

    </main>

</div>

{% endblock %}
