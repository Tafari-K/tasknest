{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'core/css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">

  <!-- Sidebar -->
<div class="avatar-section">
  <div class="avatar-container">
    <img src="{% static 'core/images/avatar-placeholder.png' %}" alt="Avatar" class="avatar-img">

    <p class="change-link">Change Profile Picture</p>

    <form method="post" enctype="multipart/form-data" class="upload-form">
      {% csrf_token %}
      <input type="file" name="avatar" class="file-input">
      <button type="submit" class="upload-btn">Upload</button>
    </form>

    <ul class="dashboard-links">
      {% if profile.role == 'tradesman' %}
        <li><a href="{% url 'add_job' %}">Add Job</a></li>
        <li><a href="{% url 'edit_profile' %}">Edit Profile</a></li>
      {% elif profile.role == 'customer' %}
        <li><a href="{% url 'search' %}">Find Tradesman</a></li>
        <li><a href="{% url 'edit_profile' %}">Edit Profile</a></li>
      {% endif %}
    </ul>
  </div>
</div>

  <!-- Main dashboard area -->
  <main class="dashboard-main">
    <div class="welcome-section">
      <h2>Welcome, {{ user.username }}!</h2>
      <p>Youâ€™re logged into your TaskNest dashboard.</p>
      <p><strong>Your role:</strong> {{ profile.role|title }}</p>
      <p>You can create and manage jobs here.</p>
      <a href="{% url 'jobs' %}" class="view-jobs-btn">View Active Jobs</a>
    </div>

    <div class="stats-card">
  <h4>Dashboard</h4>
  <ul>
    <li><strong>Active Jobs:</strong> {{ active_jobs }}</li>
    <li><strong>Completed Jobs:</strong> {{ completed_jobs }}</li>
  </ul>
</div>

<div class="thumb-section">
  <div class="thumb-header">
    <h4>Active Jobs</h4>
    <a href="{% url 'jobs' %}" class="thumb-link">View all</a>
  </div>
  <div class="thumb-grid">
    {% for job in active_jobs_list %}
      <a href="{% url 'jobs' %}" class="thumb-card" title="{{ job.title }}">
        {% if job.image %}
          <img src="{{ job.image.url }}" alt="{{ job.title }}">
        {% else %}
          <img src="{% static 'images/placeholder.jpg' %}" alt="No image">
        {% endif %}
        <div class="thumb-title">{{ job.title|truncatechars:28 }}</div>
      </a>
    {% empty %}
      <div class="thumb-empty">No active jobs yet.</div>
    {% endfor %}
  </div>
</div>

<div class="thumb-section">
  <div class="thumb-header">
    <h4>Completed Jobs</h4>
    <a href="{% url 'jobs' %}" class="thumb-link">View all</a>
  </div>
  <div class="thumb-grid">
    {% for job in completed_jobs_list %}
      <a href="{% url 'jobs' %}" class="thumb-card" title="{{ job.title }}">
        {% if job.image %}
          <img src="{{ job.image.url }}" alt="{{ job.title }}">
        {% else %}
          <img src="{% static 'images/placeholder.jpg' %}" alt="No image">
        {% endif %}
        <div class="thumb-title">{{ job.title|truncatechars:28 }}</div>
      </a>
    {% empty %}
      <div class="thumb-empty">No completed jobs yet.</div>
    {% endfor %}
  </div>
</div>
  </main>

</div>
{% endblock %}
